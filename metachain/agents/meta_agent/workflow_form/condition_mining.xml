<workflow>
    <name>math_solver_chain_workflow</name>
    <system_input>
        <key>math_problem</key>
        <description>The math problem that needs to be solved.</description>
    </system_input>
    <system_output>
        <key>solution</key>
        <description>The complete solution to the math problem.</description>
    </system_output>

    <agents>
        <agent category="existing">
            <name>Objective Extraction Agent</name>
            <description>This agent analyzes the math problem and extracts its main objective or goal.</description>
        </agent>
        <agent category="existing">
            <name>Condition Extraction Agent</name>
            <description>This agent identifies and extracts all relevant conditions and given information from the math problem.</description>
        </agent>
        <agent category="existing">
            <name>Condition Evaluator Agent</name>
            <description>This agent evaluates whether the extracted conditions are sufficient to solve the math problem.</description>
        </agent>
        <agent category="existing">
            <name>Math Solver Agent</name>
            <description>This agent solves mathematical problems using analytical and systematic approaches.</description>
        </agent>
    </agents>

    <events>
        <event>
            <name>on_start</name>
            <inputs>
                <input>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                </input>
            </inputs>
            <outputs>
                <output>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
        </event>

        <event>
            <name>extract_objective</name>
            <inputs>
                <input>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                </input>
            </inputs>
            <task>Extract and clearly state the main objective of the math problem.</task>
            <outputs>
                <output>
                    <key>objective</key>
                    <description>The main objective or question that needs to be answered.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>Objective Extraction Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>

        <event>
            <name>extract_conditions</name>
            <inputs>
                <input>
                    <key>objective</key>
                    <description>The main objective or question that needs to be answered.</description>
                </input>
            </inputs>
            <task>Extract all relevant conditions and given information from the math problem.</task>
            <outputs>
                <output>
                    <key>conditions</key>
                    <description>The complete set of conditions and information extracted from the problem.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>extract_objective</event>
            </listen>
            <agent>
                <name>Condition Extraction Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>

        <event>
            <name>evaluate_conditions</name>
            <inputs>
                <input>
                    <key>conditions</key>
                    <description>The complete set of conditions and information extracted from the problem.</description>
                </input>
            </inputs>
            <task>Evaluate if the extracted conditions are sufficient to solve the problem.</task>
            <outputs>
                <output>
                    <key>merged_conditions</key>
                    <description>The merged and organized conditions ready for problem-solving.</description>
                    <condition>When conditions are sufficient to solve the problem.</condition>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
                <output>
                    <key>insufficient_feedback</key>
                    <description>Feedback on what additional information is needed.</description>
                    <condition>When conditions are insufficient to solve the problem.</condition>
                    <action>
                        <type>GOTO</type>
                        <value>extract_conditions</value>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>extract_conditions</event>
            </listen>
            <agent>
                <name>Condition Evaluator Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>

        <event>
            <name>solve_problem</name>
            <inputs>
                <input>
                    <key>merged_conditions</key>
                    <description>The merged and organized conditions ready for problem-solving.</description>
                </input>
            </inputs>
            <task>Solve the math problem using the complete set of conditions.</task>
            <outputs>
                <output>
                    <key>solution</key>
                    <description>The complete solution to the math problem.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>evaluate_conditions</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>
    </events>
</workflow>