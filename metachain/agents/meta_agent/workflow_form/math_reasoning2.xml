<workflow>
    <system_input>
        <key>dataset_url</key>
        <description>The URL of the math problem dataset on huggingface.</description>
    </system_input>

    <system_output>
        <key>final_result</key>
        <description>The final solution of the math problem after majority voting.</description>
    </system_output>

    <agents>
        <agent category="new">
            <name>Data Loader Agent</name>
            <description>This agent is responsible for downloading and processing the dataset.</description>
            <tools>
                <tool>download_file</tool>
                <tool>analyze_data</tool>
                <tool>load_one_instance</tool>
            </tools>
        </agent>
        
        <agent category="new">
            <name>Math Solver Agent</name>
            <description>This agent is responsible for solving math problems using different language models.</description>
        </agent>

        <agent category="new">
            <name>Result Aggregator Agent</name>
            <description>This agent aggregates results from different solvers and performs majority voting.</description>
        </agent>
    </agents>

    <global_variables>
        <variable>
            <key>dataset_path</key>
            <description>Local path where the dataset will be stored</description>
            <value>/workspace/data/math_dataset.json</value>
        </variable>
    </global_variables>

    <events>
        <event>
            <name>download_data</name>
            <input>
                <key>dataset_url</key>
                <description>The URL of the math problem dataset</description>
            </input>
            <task>Download the dataset from huggingface and analyze its structure</task>
            <outputs>
                <output>
                    <key>problem_instance</key>
                    <description>A single math problem instance from the dataset</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <agent>
                <name>Data Loader Agent</name>
                <model>gpt-4o-2024-08-06</model>
            </agent>
        </event>

        <event>
            <name>solve_with_gpt4</name>
            <input>
                <key>problem_instance</key>
                <description>Math problem to solve</description>
            </input>
            <task>Solve the math problem using GPT-4</task>
            <outputs>
                <output>
                    <key>gpt4_solution</key>
                    <description>Solution from GPT-4 model</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>download_data</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>gpt-4o-2024-08-06</model>
            </agent>
        </event>

        <event>
            <name>solve_with_claude</name>
            <input>
                <key>problem_instance</key>
                <description>Math problem to solve</description>
            </input>
            <task>Solve the math problem using Claude</task>
            <outputs>
                <output>
                    <key>claude_solution</key>
                    <description>Solution from Claude model</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>download_data</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>

        <event>
            <name>solve_with_palm</name>
            <input>
                <key>problem_instance</key>
                <description>Math problem to solve</description>
            </input>
            <task>Solve the math problem using PaLM</task>
            <outputs>
                <output>
                    <key>palm_solution</key>
                    <description>Solution from PaLM model</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>download_data</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>palm-2-4-chat-20240125</model>
            </agent>
        </event>

        <event>
            <name>aggregate_results</name>
            <input>
                <key>solutions</key>
                <description>Solutions from all models</description>
            </input>
            <task>Aggregate solutions using majority voting</task>
            <outputs>
                <output>
                    <key>final_result</key>
                    <description>Final solution after majority voting</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>solve_with_gpt4</event>
                <event>solve_with_claude</event>
                <event>solve_with_palm</event>
            </listen>
            <agent>
                <name>Result Aggregator Agent</name>
                <model>gpt-4o-2024-08-06</model>
            </agent>
        </event>
    </events>
</workflow>